<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<form id="loginForm" style="max-width:350px;margin:auto;">
  <label for="username">Username or Email:</label><br>
  <input type="text" id="username" name="username" required><br><br>
  <label for="password">Password:</label><br>
  <input type="password" id="password" name="password" required><br><br>
  <button type="submit">Login</button>
</form>
<div id="loginMsg" style="color:red;text-align:center;margin-top:15px;"></div>
<script>
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!username || !password){ document.getElementById('loginMsg').innerText = 'Please enter both username and password.'; return; }
    // Try server-side login first
    fetch('/api/auth/login', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ email: username, password }) })
      .then(async res => {
        if(res.ok){ const data = await res.json(); localStorage.setItem('isLoggedIn','true'); localStorage.setItem('username', data.name || data.email || username); window.location.href = 'Bookslot.html'; }
        else {
          // fallback: demo acceptance if server not found or returns error
          const text = await res.text().catch(()=>'');
          console.warn('Login failed', res.status, text);
          // for demo allow any credentials if backend is unreachable
          if(res.status === 0 || res.status === 404 || res.status === 502 || res.status === 504){
            localStorage.setItem('isLoggedIn','true'); localStorage.setItem('username', username); window.location.href = 'Bookslot.html';
          } else {
            document.getElementById('loginMsg').innerText = 'Login failed. Check credentials.';
          }
        }
      }).catch(err => {
        console.warn('Auth server not reachable, falling back to demo login', err);
        localStorage.setItem('isLoggedIn','true'); localStorage.setItem('username', username); window.location.href = 'Bookslot.html';
      });
  });
</script>
</body>
</html>