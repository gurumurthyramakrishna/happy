<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login - Happy Mop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--brand:#005544;--accent:#0078d4}
    body{background:#f5f7fb;font-family:Inter,Arial,sans-serif}
    .login-container{max-width:400px;margin:80px auto;padding:20px}
    .card{border:none;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.08)}
    .btn-primary{background:var(--accent);border:none}
    .form-control{border-radius:8px;padding:12px}
    .brand-header{color:var(--brand);text-align:center;margin-bottom:30px}
  </style>
</head>
<body>
<div class="login-container">
  <div class="brand-header">
    <h2><a href="index.html" style="text-decoration:none;color:inherit">Happy Mop</a></h2>
    <p class="text-muted">Sign in to your account</p>
  </div>
  
  <div class="card">
    <div class="card-body p-4">
      <form id="loginForm">
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Sign In</button>
        <div id="loginMsg" class="text-center mt-3"></div>
      </form>
      
      <div class="text-center mt-4">
        <p class="mb-0">Don't have an account? <a href="signup.html">Sign up</a></p>
        <p class="mt-2"><a href="index.html">‚Üê Back to Home</a></p>
      </div>
    </div>
  </div>
</div>
<script>
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!email || !password){ document.getElementById('loginMsg').innerText = 'Please enter both email and password.'; return; }
    // Try server-side login first
    const API_BASE = (window.location.protocol === 'file:' || window.location.origin === 'null' || window.location.port === '63342') ? 'http://localhost:8080' : window.location.origin;
    fetch(API_BASE + '/api/users/login', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ email, password }) })
      .then(async res => {
        if(res.ok){ 
          const data = await res.json(); 
          localStorage.setItem('isLoggedIn','true'); 
          localStorage.setItem('username', data.name || data.email || email); 
          localStorage.setItem('userId', data.id);
          document.getElementById('loginMsg').innerHTML = '<span style="color:green">Login successful! Redirecting...</span>';
          setTimeout(() => window.location.href = 'index.html', 1000);
        }
        else {
          // fallback: demo acceptance if server not found or returns error
          const text = await res.text().catch(()=>'');
          console.warn('Login failed', res.status, text);
          // for demo allow any credentials if backend is unreachable
          if(res.status === 0 || res.status === 404 || res.status === 502 || res.status === 504){
            localStorage.setItem('isLoggedIn','true'); localStorage.setItem('username', username); window.location.href = 'Bookslot.html';
          } else {
            const errorData = JSON.parse(text);
            document.getElementById('loginMsg').innerHTML = '<span style="color:red">' + (errorData.error || 'Login failed. Please check your credentials.') + '</span>';
          }
        }
      }).catch(err => {
        console.warn('Auth server not reachable', err);
        document.getElementById('loginMsg').innerHTML = '<span style="color:red">Unable to connect to server. Please try again later.</span>';
      });
  });
</script>
</body>
</html>